IoT ist ein Thema, das immer bedeutender wird in der heutigen Zeit, gerade durch das immer mehr aufkommende Thema Smart Home. Dieses Kapitel wird eine kurze Einführung in das Thema IoT geben und dann die Möglichkeiten von AWS IoT beschreiben.

\section{Einführung IoT}
Nach der Einschätzung von Daniele Miorandi u.a. \cite{iot_vision} gibt es im Moment eine Weiterentwicklung des Internets, das nun nicht mehr nur Endbenutzergeräte miteinander verbindet, sondern auch ganz alltägliche Objekte verbindet, die miteinander kommunizieren oder auch mit dem Menschen kommunizieren und so ganz neue Möglichkeiten dem Endbenutzer geben. Dies wird als Internet of Things (IoT) bezeichnet. Das Internet of Things basiert auf 3 Punkten, die alltägliche Objekte nun können müssen, um Teil des Internet of Things zu sein: 
\begin{enumerate}
	\item Eindeutig identifizierbar sein (Jedes Objekt beschreibt sich selbst, z.b. mittels RFID)
	\item Kommunikationsfähig sein
	\item Interaktionsfähig sein, mit anderen Objekten oder mit Nutzern
\end{enumerate}

Teil des Internet (of Things) werden nun also nicht mehr nur Rechner unterschiedlichster Art (PC, Smartphone etc.), sondern jeder alltägliche Gegenstand wird Teil des Internets und kann mit anderen Objekten kommunizieren. So wären in diesem Projekt die Sensoren Teil des Internet of Things, da sie die oben genannten 3 Punkte erfüllen und nicht nur isoliert für sich selbst funktionieren. \newline
Das Internet of Things bietet also für die Zukunft viele Möglichkeiten, die Funktionen von alltäglichen Gegenständen des Lebens zu erweitern. So können bspw. die Temperatursensoren mit der Klimaanlage kommunizieren, die daraufhin die Temperatur reguliert. Lampen können mittels eines Smartphones auch außerhalb des Hauses gesteuert werden oder regulieren sich selbst, wenn sie die Nachricht eines Lichtsensors empfangen, dass es im Moment zu dunkel oder zu hell ist. \newline
Auch in der Industrie wird das Internet of Things immer mehr Einzug halten und Produktionsprozesse weiter automatisieren, da Produktionsmaschinen nun auch mit anderen Geräten kommunizieren können. \newline
Großes Thema im Bereich IoT ist die Sicherheit, besonders da nun auch alltägliche Geräte Teil des Internet of Things werden. Dementsprechend wäre es möglich, dass sich eine Person Zugriff auf nahezu alle Geräte innerhalb eines Haushalts verschaffen könnte, ohne dass der Besitzer davon etwas weiß. Daher sind sichere Authentifizierungsverfahren und Kommunikationswege ein wichtiger Teil des IoT. \newline
Insgesamt kann man also sagen, dass das Internet of Things sicherlich einer der nächsten großen Schritte in der IT sein wird und in einigen Jahren viele Objekte im Haushalt und in Firmen Teil des IoT sein werden. Die wohl größte Herausforderung wird das Thema Sicherheit sein, um die Sicherheit und Privatssphäre von Nutzern von Objekten im IoT zu schützen.
\section{Einführung AWS IoT}
AWS IoT \cite{iot} ist einer der neueren Web Services von Amazon, welcher zunächst im Oktober 2015 in eine Beta Phase gestartet ist und seit Januar 2016 in den regulären Betrieb gewechselt ist. Es ist eine verwaltete Cloud Plattform, mit der verbundene Geräte mit Cloud Anwendungen und anderen Geräten zusammenarbeiten können. \newline
AWS IoT kann Millionen von Nachrichten von typischen IoT Geräten wie bspw. Sensoren annehmen und an weitere Amazon Web Services oder andere IoT Geräte verteilen. Dies bietet zum einen die Möglichkeit der Kommunikation von IoT Geräten untereinander sowie die Möglichkeit der IoT Geräte mit der Cloud zu kommunizieren um beispielsweise Daten zu übermitteln, die dann in Cloud Services verarbeitet und/oder persistiert werden. Beispiele wären zum Beispiel ein Temperatursensor, der mittels AWS IoT der Klimaanlage des Hauses die Nachricht übermittelt, dass die Temperatur höher geregelt werden muss oder der Temperatursensor schickt seine Temperaturdaten an andere Amazon Web Services wie bspw. Amazon DynamoDB, welches die Daten dann persistieren kann. Amazon nennt als Beispiel eine Reihe von Temperatursensoren, die ihre Daten an AWS IoT senden. AWS IoT sendet dann bei Überschreiten eines bestimmten Grenzwertes ein Kommando an einen Ventilator im Haus, der sich daraufhin einschaltet. Der Ventilator kann aber auch bspw. über eine Mobilapplikation von einem Benutzer über AWS IoT manuell gestartet werden (s. Abbildung \ref{fig:iot_authentication}).
\begin{figure}[h!]
	
	\includegraphics[width=1.0\textwidth]{content/images/IoT_Authentication.png}
	
	\caption{Kommunikation und Authentifikation von Temperatursensoren und einem Ventilator mit AWS IoT. Quelle: \cite{iot}}
	
	\label{fig:iot_authentication}
	
\end{figure}
Dementsprechend ist AWS IoT eine gute Alternative, sollte man dieses Projekt mit echten Temperatursensoren ausführen wollen.
\section{Funktionsweise}
Ein wichtiger Punkt bei AWS IoT ist die Sicherheit der Kommunikation zwischen den einzelnen Endpunkten. Sicherheit ist bei IoT generell ein großes Thema, da unter Umständen mit sensiblen Daten gearbeitet wird, die im eigenen Haus erzeugt werden. AWS IoT stellt sicher, dass keine Kommunikation über AWS IoT unverschlüsselt stattfindet, indem sich jeder Endpunkt zunächst bei AWS IoT authentifizieren muss. Jede Kommunikation wird einzeln authentifiziert und verschlüsselt. Dies sieht man z.B. in Abbildung  \ref{fig:iot_authentication}. Hier wird in Schritt 2 die Kommunikation der Temperatursensoren mit AWS IoT authentifiziert, bevor sie die Daten an AWS IoT senden. In Schritt 4 wird die Kommunikation mit dem Ventilator ebenfalls zunächst authentifiziert. Und natürlich können nur authentifizierte Nutzer über Mobilapplikationen über AWS IoT wie in diesem Beispiel den Ventilator kontrollieren.
\begin{figure}[h!]
	
	\includegraphics[width=1.1\textwidth]{content/images/IoT_Functions.png}
	
	\caption{Funktionsübersicht von AWS IoT. Quelle: \cite{iot_functions}}
	
	\label{fig:iot_functions}
	
\end{figure}

Abbildung \ref{fig:iot_functions} zeigt eine Funktionsübersicht von AWS IoT. Hier steht zunächst einmal auf der linken Seite die AWS Device SDK, die eine Reihe von Client Libraries bereitstellt, mit der Geräte mit AWS IoT kommunizieren können. Die Kommunikation findet dabei über die Protokolle MQTT \cite{mqtt} oder HTTP statt. MQTT ist ein leichtgewichtiges Nachrichtenprotokoll für die direkte Kommunikation zwischen Maschinen (M2M) und ist daher ein häufig genutztes Protokoll im Bereich des IoT. Mittels einem dieser beiden Protokolle kommuniziert das Gerät, das die AWS Service SDK nutzt, mit dem Device Gateway. Die Kommunikation wird dabei verschlüsselt und zunächst müssen sich beide Seiten auch authentifizieren, bevor überhaupt eine Kommunikation zustande kommt. AWS IoT unterstützt dabei die AWS-Methode der Authentifizierung (mit der Bezeichnung ``SigV4'') sowie eine Authentifizierung auf der Basis von X.509 \cite{iot_functions}. Den Geräten können einzelne Richtlinien vorgegeben werden, die ihren Zugriff entsprechend einschränken oder es können Rollen definiert werden, die Geräten eine genau spezifizierte Menge an Rechten geben. \newline
Die Registry erstellt eine eindeutige Identität für die Geräte. Diese ist für alle Geräte egal welcher Art einheitlich formatiert. Außerdem werden Metadaten von Geräten gespeichert, die bspw. angeben, welche Funktionen dieses Gerät unterstützt wie zum Beispiel, dass ein Sensor Temperaturdaten meldet und in welcher Einheit diese Temperaturdaten übermittelt werden. \newline
Das Device Gateway stellt für Applikationen REST APIs bereit, über die die Applikationen die Statusinformationen von Geräten auslesen und manipulieren können. Dazu legt das Device Gateway sogenannte ``Device Shadows'' bzw. ``Schattengeräte'' an, die den letzten Zustand des Gerätes darstellen. Das heißt, dass der Zustand von Geräten auch dann ausgelesen werden kann, wenn das Gerät gar nicht mehr online ist, da der letzte Zustand als ``Schattengerät'' gespeichert wurde. Zudem können Applikationen so auch den gewünschten zukünftigen Zustand festlegen. Auch dieser wird im ``Schattengeräte'' persistiert und wird auf das Gerät übertragen, wenn es wieder online ist. Damit ist es möglich, auch für Geräte, die nicht dauerhaft online sind, eine REST API bereitzustellen, die dauerhaft verfügbar ist und Applikationen ermöglicht, sich immer mit dem ``Schattengerät'' zu synchronisieren und den Status zu verändern. Die Kommunikation erfolgt auch hier wieder über verschlüsselte Nachrichten.
\begin{figure}[h!]
	\includegraphics[width=1.1\textwidth]{content/images/IoT_S3.png}
	
	\caption{Beispiel der Kommunikation von AWS IoT mit anderen Amazon Services wie S3. Quelle: \cite{iot}}
	
	\label{fig:iot_s3}
	
\end{figure}
Das Device Gateway kann aber auch über die Rules Engine Daten von Geräten transformieren und an andere Services weiterleiten. So könnten beispielsweise Temperaturdaten an Amazon DynamoDB oder andere Datenbank Services weitergeleitet werden. Die Abbildung \ref{fig:iot_S3} zeigt die Kommunikation von AWS IoT mit Amazon S3, bei der Performance Daten von Autos über AWS IoT an S3 übermittelt und zur weiteren Auswertung gespeichert werden.  \newline
Es können aber auch Regeln erstellt werden, die bei bestimmten Konditionen Aktionen auslösen. Zum Beispiel könnte beim Überschreiten einer bestimmten Menge an Temperaturen eine Nachricht an AWS Lambda \cite{lambda} geschickt werden, das daraufhin den Mittelwert der gesammelten Daten berechnet. Nachrichten können aber auch an Geräte geschickt werden wie in Abbildung \ref{fig:iot_authentication}. Erreicht die Temperatur der Sensoren einen Grenzwert, greift eine Regel und sendet den Befehl an den Ventilator, der sich daraufhin einschaltet. \newline
Die Regeln werden direkt in der Management Konsole eingetragen oder über eine SQL-ähnliche Syntax definiert.  \newline
AWS IoT bietet also passende Funktionen, um das Projekt mit echten Temperatursensoren umzusetzen. Man könnte die Temperaturdaten direkt an einen Datenbank Service wie Amazon DynamoDB weiterleiten und auch die Temperatursensoren über die REST API direkt steuern. Mittels der Rules Engine könnten Regeln festgelegt werden, nach denen bei bestimmten Temperaturen bestimmte Aktionen ausgeführt werden können. Dadurch könnte man auch andere Geräte wie beispielsweise Ventilatoren oder Klimaanlagen einbinden und mittels AWS IoT steuern lassen. Man benötigt aber neben den Sensoren auch Mikrocontroller wie bspw. Raspberry PIs \cite{raspberry}, die mit den Sensoren und anderen Geräten kommunizieren können, um AWS IoT nutzen zu können.  \newline \newline


\section{AWS IoT CLI, SDK und APIs}
Die AWS IoT CLI bietet die Möglichkeit über Kommandozeileneingaben verschiedene Funktionen von AWS IoT zu nutzen.. Beispielsweise können Geräte zur Device Registry hinzugefügt werden und Einträge in der Registry verändert werden. 

\lstinputlisting[firstline=1, lastline=1, caption=Einfügen eines Geräts in die Registry. Quelle: \cite{iot_registry} , label=iot_describe_1, style=java]{content/listings/iot_describe.txt}

Der Quellcode \ref{iot_describe_1} zeigt den Befehl, mit dem ein Gerät mit dem Namen ``MyDevice3'' in die Registry eingefügt werden kann.

\lstinputlisting[firstline=2, lastline=10, caption=Geräteeintrag in der Registry. Quelle: \cite{iot_registry} , label=iot_describe_2, style=java]{content/listings/iot_describe.txt}

Der Eintrag in der Registry sieht dann wie in Quelltext \ref{iot_describe_2} aus. Weitere Attribute wie eine einzigartige Seriennummer werden automatisch generiert. \newline
Die AWS IoT CLI bietet zudem auch die Möglichkeit alle Geräte in der Registry anzuzeigen oder die Suchergebnisse zu filtern. \newline
Mittels SDK lassen sich auch Regeln erstellen, einsehen und bearbeiten.

\lstinputlisting[firstline=1, lastline=1, caption=Erstellen einer AWS IoT Regel. Quelle: \cite{iot_rules} , label=iot_rule_1, style=java]{content/listings/iot_create_rule.txt}

In Quelltext \ref{iot_rule_1} wird eine Regel mit dem Namen ``my-rule'' erzeugt. Zudem wird eine payload Datei namens ``my-rule.json'' ebenfalls mitgeschickt.

\lstinputlisting[firstline=2, lastline=15, caption=Inhalt einer Payload Datei. Quelle: \cite{iot_rules} , label=iot_rule_2, style=java]{content/listings/iot_create_rule.txt}

Die Payload Datei in Quelltext \ref{iot_rule_2} enthält die Regel, alle Nachrichten, die an die Topic ``iot-topic'' gesendet werden, in die DynamoDB Tabelle ``my-dynamodb-table'' zu schreiben. Dabei wird noch eine Rolle übergeben, die in diesem Fall das Recht hat, auf die DynamoDB Tabelle zuzugreifen und in diese zu schreiben. Als HashkeyValue wird der Name der Topic übergeben und als rangeKeyValue der Timestamp der Nachricht.

\lstinputlisting[firstline=1, lastline=1, caption=GET Anfrage an einen ``Geräteschatten''. Quelle: \cite{iot_get_thingshadow} , label=iot_get_shadow_1, style=java]{content/listings/iot_get_thingshadow.txt}

Mittels einer REST API können die ``Geräteschatten'' von Geräten abgefragt und auch manipuliert werden. Quelltext  \ref{iot_get_shadow_1} zeigt eine HTTP GET Anfrage an einen Geräteschatten, wobei ``endpoint'' und ``thingName'' Variablen sind, die man in der AWS IoT Konsole auslesen kann oder auch per AWS IoT SDK.

\lstinputlisting[firstline=2, lastline=3, caption=GET Antwort auf die Anfrage an einen ``Geräteschatten''. Quelle: \cite{iot_get_thingshadow} , label=iot_get_shadow_2, style=java]{content/listings/iot_get_thingshadow.txt}

Quelltext  \ref{iot_get_shadow_2} zeigt die Antwort auf eine Anfrage an einen ``Geräteschatten''. ``response state document'' ist hierbei ein größeres Dokument, das Informationen über den Status des ``Geräteschattens'' sowie Metadaten, einen Timestamp und andere Informationen enthält. \newline
Über die API ist es auch möglich, ``Geräteschatten'' zu bearbeiten und zum Beispiel einen neuen Status zu setzen, der dann im Gerät gesetzt wird, wenn es online ist oder auch ``Geräteschatten'' zu löschen. \newline
Es gibt außerdem noch eine AWS IoT SDK \cite{iot_sdk}, die die Integration von Geräten in AWS IoT vereinfacht. Die SDK ist für C, Arduino Yún \cite{arduino_yun} und Node.js \cite{nodejs} verfügbar. \newline
Sie bietet Funktionen zum Anmelden der Geräte bei AWS IoT, dem Aufbauen von Verbindungen und Senden von Nachrichten über die Verbindung sowie zum Bearbeiten von ``Geräteschatten''.

\section{Zusammenfassung}
IoT wird ein wichtiger Teil der IT in den nächsten Jahren sein und AWS IoT kann helfen, IoT auch dem Massenmarkt verfügbar zu machen. Im Weg stehen im Moment die geringe Einsteigerfreundlichkeit der zu AWS IoT kompatiblen Geräte. Direkt kompatibel sind nur einige von Amazon angebotene Geräte und auch dort ist noch eine Menge Konfigurationsarbeit nötig. Die Dokumentation dieser Geräte ist leider bisher auch nicht allzu gut und es lassen sich nur wenige Erfahrensberichte finden. Da AWS IoT Stand Februar 2016 allerdings auch erst einen Monat offiziell nutzbar ist, kann sich dies im Laufe der Zeit noch ändern. Wenn AWS IoT in der Zukunft auch mit weniger Aufwand betreibbar ist, kann es ein wichtiger Teil des IoT Marktes werden.